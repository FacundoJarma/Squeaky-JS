---
import { Icon } from "astro-icon/components";
const { classList, difficult, name, description, index, url } = Astro.props;
---

<div
  class={`lection relative flex flex-col bg-[#23262f] border-2 border-[#353841] rounded-xl w-full p-4 ${classList}`}
>
  <!-- <div
    class="absolute -top-3 -left-3 text-xs bg-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-white"
  >
    {index}
  </div> -->
  <main class="flex-1">
    <a href={"/lecciones/" + url}>
      <h2
        class="text-2xl text-white mb-2 font-[inter] font-semibold"
        transition:name={`lectionTitle-${index}`}
      >
        {name}
      </h2>
    </a>
  </main>

  <footer class="flex items-center justify-between h-8">
    <button
      data-url={url}
      class="addFav flex items-center justify-center hover:bg-neutral-700 p-1 rounded-full duration-100 cursor-pointer"
    >
      <Icon name="star" height={20} width={20} class={"text-gray-300"} />
    </button>
    <span
      class:list={[
        "text-sm px-4 py-0.5 text-white rounded-full",
        {
          "bg-green-700": difficult === "Fácil",
        },
        {
          "bg-yellow-700": difficult === "Medio",
        },
        {
          "bg-red-700": difficult === "Difícil",
        },
      ]}>{difficult}</span
    >
  </footer>
</div>

<style>
  .lection {
    transition: all 0.2s ease-in-out;
  }
  .lection:hover {
    scale: 1.03;
  }
</style>

<script>

  import { postData } from "../lib/socket.js";
  import Toastify from "toastify-js";
  const añadirFav = (data) => {
    const user = JSON.parse(localStorage.getItem("user"));
    data.username = user.username;
    postData("favorito", data, () => {
      Toastify({
        text: "Lección añadida a favoritos!",
        duration: 1000, // Duración de 2 segundos
        stopOnFocus: true,
      }).showToast();
    });
  };
  const $addFavs = document.querySelectorAll(
    ".addFav"
  ) as NodeListOf<HTMLButtonElement>;

  $addFavs.forEach(($addFav) => {
    $addFav.addEventListener("click", () => {
      const url = $addFav.dataset.url;
      añadirFav({
        favoritos: url,
      });
    });
  });
</script>
