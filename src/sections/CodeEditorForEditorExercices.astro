---

---

<section class="relative h-[85vh] w-1/2 bg-gray-700">
  <p class="bg-gray-600 py-2 px-6 h-[20vh]">
    En la pagina de tue derecha veras una puerta cerraad (representada por el
    color 'rojo'), debes crear un codigo en el editor de la izquierda que lea
    una variable llamada 'number' y verifique que el valor sea mayor o igual a
    18, en caso de serlo, llama a la funcion 'abrirPuerta()', de no serlo, llama
    a 'cerrarPuerta()'
  </p>
  <textarea
    class="w-full h-[65vh] resize-none p-4 focus:outline-none"
    id="editor"></textarea>
  <button
    id="submitCodeBtn"
    class="px-12 py-2 bg-green-800 rounded-lg absolute bottom-5 right-5 hover:scale-105 duration-300"
  >
    Ejecutar Codigo
  </button>
</section>

<script>
  const codeEditorElement = document.getElementById(
    "editor"
  ) as HTMLTextAreaElement;
  const submitCodeBtn = document.getElementById(
    "submitCodeBtn"
  ) as HTMLButtonElement;

  const getPreRenderedHTML = async () => {
    const html = await fetch("/emulatedPages/1.html")
      .then((res) => res.text())
      .then((html) => html);
    return html;
  };

  async function handleSubmitCode() {
    const iframe = document.getElementById("editorPage-1") as HTMLIFrameElement;
    const code = codeEditorElement.value;
    const preRenderedHTML = await getPreRenderedHTML();

    const finalHTML = preRenderedHTML
      .replace("code", code)
      .replace("exe", "checkExercice()");
    iframe.srcdoc = finalHTML;
  }

  //Send Code with keyboardCommands
  document.addEventListener("keydown", (event) => {
    const isCtrlPressed = event.metaKey || event.ctrlKey;
    if (isCtrlPressed && event.key === "Enter") {
      event.preventDefault();
      handleSubmitCode();
    }
  });

  document.addEventListener("DOMContentLoaded", async () => {
    const iframe = document.getElementById("editorPage-1") as HTMLIFrameElement;

    iframe.setAttribute("srcdoc", await getPreRenderedHTML());
  });

  submitCodeBtn?.addEventListener("click", handleSubmitCode);
</script>
